# Tema 4. Trabajo con API

## Unidad 2. Peticiones GET y POST con Fetch

## Ejercicio 4.2.1 (Castellano)

Para poder trabajar con una API y los diferentes tipos de peticiones vamos a hacer uso del servicio web gratuito proporcionado por:<br>
https://reqres.in

Este servicio nos ofrece un **dataset** de usuarios sobre el que trabajar con diferentes **endpoints** y métodos.

La documentación sobre dicha API se puede consultar aquí:<br>
https://reqres.in/api-docs/

Donde puedes ver para cada **endpoint** los posibles parámetros e incluso realizar pruebas usando diferentes valores para los mismos.

En este ejercicio vamos a practicar las peticiones `GET` y `POST` contra una API REST, y concretamente lo vamos a hacer para realizar un login y una vez correctamente logueados obtener la lista de usuarios y sobre ella los datos de un usuario en particular.

Para ello:

### A. Clase `ReqRes`

Crea una clase `ReqRes` que será la encargada de gestionar las peticiones contra el servicio web.


### B. Propiedades para llamadas a la API

Añade a la clase las propiedades estáticas siguientes para tener disponibles las urls de los diferentes **endpoints**:

- `API_URL`: que tendrá el valor `https://reqres.in/api`.

- `ENDPOINT_REGISTER`: que tendrá el valor `/register`.

- `ENDPOINT_LOGIN`: que tendrá el valor `/login`.

- `ENDPOINT_USERS`: que tendrá el valor `/users`.



### C. Propiedad `session`

Añade a la clase una propiedad denominada `session` que será la encargada de almacenar durante la sesión los datos del usuario y el token de sesión. Esta propiedad se ha de inicializar con el siguiente objeto:

```js
{
    token: null,
    email: null,
    userId: null
}
```


### D. Método `register`

Crea para la clase un método `register` con las siguientes características:

- Recibe como parámetros `email` y `pwd`, y devuelve una promesa implementando la funcionalidad que se describe en los siguientes puntos.

- Si no recibe `email` devuelve la promesa resuelta dando como respuesta el siguiente objeto:

```js
{
    error: 'Missing email or username'
}
```

- Si no recibe `pwd` devuelve la promesa resuelta dando como respuesta el siguiente objeto:

```js
{
    error: 'Missing password'
}
```

- Si recibe los dos parámetros guarda el valor de `email` en la propiedad `session.email` y realiza la petición `fetch` por `POST` correspondiente al **endpoint** `ENDPOINT_REGISTER` de la API y devuelve como respuesta la promesa que devuelve la propia petición `fetch`.


### E. Método `onRegister`

Crea para la clase un método `onRegister` que recibe un único parámetro `data` e implementa las siguientes funcionalidades:

- Si no recibe `data` o `data` contiene la propiedad `error` en su interior, devolverá el **string** (lo indicado entre corchetes ha de sustituirse por el valor de `data.error`):

```
ERROR_REGISTER. [mensaje_error]
```

- Si recibe `data` y no contiene `error`, guarda el valor del campo `data.id` en la propiedad `session.userId, y el valor del campo `token` en la propiedad `session.token`.


### F. Método `login`

Crea para la clase un método `login` que recibe como parámetro `email` y `pwd`, y devuelve una promesa implementando la siguiente funcionalidad:


- Si no recibe `email` devuelve la promesa resuelta dando como respuesta el siguiente objeto:

```js
{
    error: 'Missing email or username'
}
```

- Si no recibe `pwd` devuelve la promesa resuelta dando como respuesta el siguiente objeto:

```js
{
    error: 'Missing password'
}
```

- Si recibe los dos parámetros guarda el valor de `email` en la propiedad `session.email` y realiza la petición `fetch` por `POST` correspondiente al **endpoint** `ENDPOINT_LOGIN` de la API y devuelve como respuesta la promesa que devuelve la propia petición `fetch`.


### G. Método `onLogin`

Crea para la clase un método `onLogin` que recibe como parámetro `data` satisfaciendo la siguiente funcionalidad:

- Si no recibe `data` o `data` contiene la propiedad `error` en su interior, devolverá el **string** (lo indicado entre corchetes ha de sustituirse por el valor de `data.error`):

```
ERROR_LOGIN. [mensaje_error]
```

- Si recibe `data` y no contiene `error`, guarda el valor del campo `token` en la propiedad `session.token`.


### H. Método `getUserList`

Crea para la clase un método `getUserList` que reciba como parámetros opcionales `page` (valor por defecto `1`) y `perPage` (valor por defecto `6`), realizando una petición `fetch` por `GET` al **endppoint** `ENDPOINT_USERS` pasándoles como parámetros la página y el número de registros por página.

Este método simplemente devuelve la promesa resultante de la petición `fetch` sobre la API, de manera que los resultados puedan ser usados en cualquier otro punto de la aplicación, por ejemplo con un código como este:

```js
const api = new ReqRes();

api.getUserList()
    .then((response) => {
        console.log(response.data[0]);
    })
    .catch((error) => error);
```


### I. Exportar la clase

Para terminar, vamos a exportar la clase `ReqRes` para que pueda ser empleada en otros módulos.


-----


# Tema 4. Treball amb API

## Unitat 2. Peticions GET i POST amb Fetch

## Exercici 4.2.1 (Català)

Per poder treballar amb una API i els diferents tipus de peticions farem ús del servei web gratuït proporcionat per:<br>
https://reqres.in

Aquest servei ens ofereix un **dataset** d'usuaris sobre el qual treballar amb diferents **endpoints** i mètodes.

La documentació sobre aquesta API es pot consultar aquí:<br>
https://reqres.in/api-docs/

On pots veure per a cada endpoint els possibles paràmetres i fins i tot realitzar proves usant diferents valors per a aquests.

En aquest exercici practicarem les peticions `GET` i `POST` contra una API REST, i concretament ho farem per realitzar un login i una vegada correctament loguejats obtenir la llista d'usuaris i sobre ella les dades d'un usuari en particular .

Per això:

### A. Classe `ReqRes`

Creeu una classe `ReqRes` que serà l'encarregada de gestionar les peticions contra el servei web.


### B. Propietats per a trucades a l'API

Afegeix a la classe les propietats estàtiques següents per tenir disponibles les urls dels diferents **endpoints**:

- `API_URL`: que tindrà el valor `https://reqres.in/api`.

- `ENDPOINT_REGISTER`: que tindrà el valor `/register`.

- `ENDPOINT_LOGIN`: que tindrà el valor `/login`.

- `ENDPOINT_USERS`: que tindrà el valor `/users`.



### C. Propietat `session`

Afegeix a la classe una propietat anomenada `session` que serà l'encarregada d'emmagatzemar durant la sessió les dades de l'usuari i el token de sessió. Aquesta propietat s'ha d'inicialitzar amb l'objecte següent:

```js
{
     token: null,
     email: null,
     userId: null
}
```


### D. Mètode `register`

Crea per a la classe un mètode `register` amb les característiques següents:

- Rep com a paràmetres `email` i `pwd`, i torna una promesa implementant la funcionalitat que es descriu en els següents punts.

- Si no rep `email` retorna la promesa resolta donant com a resposta el següent objecte:

```js
{
     error: 'Missing email or username'
}
```

- Si no rep `pwd` retorna la promesa resolta donant com a resposta el següent objecte:

```js
{
     error: 'Missing password'
}
```

- Si rep els dos paràmetres guarda el valor de `email` a la propietat `session.email` i fa la petició `fetch` per `POST` corresponent al **endpoint** `ENDPOINT_REGISTER` de l'API i torna com a resposta la promesa que torna la pròpia petició `fetch`.


### E. Mètode `onRegister`

Crea per a la classe un mètode `onRegister` que rep un únic paràmetre `data` i implementa les funcionalitats següents:

- Si no rep `data` o `data` conté la propietat `error` al seu interior, tornarà el **string** (l'indicat entre claudàtors ha de substituir-se pel valor de `data.error`):

```
ERROR_REGISTER. [missatge_error]
```

- Si rep `data` i no conté `error`, desa el valor del camp `data.id` a la propietat `session.userId, i el valor del camp `token` a la propietat `session.token`.


### F. Mètode `login`

Crea per a la classe un mètode `login` que rep com a paràmetre `email` i `pwd`, i torna una promesa implementant la següent funcionalitat:


- Si no rep `email` retorna la promesa resolta donant com a resposta el següent objecte:

```js
{
     error: 'Missing email or username'
}
```

- Si no rep `pwd` retorna la promesa resolta donant com a resposta el següent objecte:

```js
{
     error: 'Missing password'
}
```

- Si rep els dos paràmetres desa el valor de `email` a la propietat `session.email` i fa la petició `fetch` per `POST` corresponent al **endpoint** `ENDPOINT_LOGIN` de l'API i torna com a resposta la promesa que torna la pròpia petició `fetch`.


### G. Mètode `onLogin`

Crea per a la classe un mètode `onLogin` que rep com a paràmetre `data` satisfent la funcionalitat següent:

- Si no rep `data` o `data` conté la propietat `error` al seu interior, tornarà el **string** (l'indicat entre claudàtors ha de substituir-se pel valor de `data.error`):

```
ERROR_LOGIN. [missatge_error]
```

- Si rep `data` i no conté `error`, desa el valor del camp `token` a la propietat `session.token`.


### H. Mètode `getUserList`

Crea per a la classe un mètode `getUserList` que rebi com a paràmetres opcionals `page` (valor per defecte `1`) i `perPage` (valor per defecte `6`), realitzant una petició `fetch` per `GET` al **endppoint** `ENDPOINT_USERS` passant-los com a paràmetres la pàgina i el nombre de registres per pàgina.

Aquest mètode simplement torna la promesa resultant de la petició `fetch` sobre l'API, de manera que els resultats puguin ser usats en qualsevol altre punt de l'aplicació, per exemple amb un codi com aquest:

```js
const api = new ReqRes();

api.getUserList()
     .then((response) => {
         console.log(response.data[0]);
     })
     .catch((error) => error);
```

### I. Exportar la classe

Per acabar, exportarem la classe `ReqRes` perquè pugui ser emprada en altres mòduls.
